<!DOCTYPE html>
<html>
<head>
    <title>PharmaFind</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>

<header>
    <div class="header-left">
        <span class="brand-text">PharmaFind</span>
        <span class="brand-icon">ðŸ’Š</span>
    </div>

    <div class="header-right">
        <a href="/login">Pharmacy Login</a>
    </div>
</header>

<div class="container">

    <p>Find medicines in nearby pharmacies</p>

    <form method="POST" class="search-box">
        <input type="text" name="medicine" placeholder="Search medicine" required>

        <!-- Hidden GPS fields -->
        <input type="hidden" name="user_lat" id="user_lat">
        <input type="hidden" name="user_lon" id="user_lon">

        <button type="submit">Search</button>
    </form>

    {% if results is not none %}
    <h2>Results:</h2>
    {% endif %}

    {% if results is not none %}
        {% if results %}
            {% for item in results %}
                <div class="result-card">
                    <strong>{{ item[0] }}</strong><br>
                    Pharmacy: {{ item[1] }}<br>
                    Phone: {{ item[6] }}<br>
                    Stock: {{ item[2] }}<br>

                    {% if item[5] %}
                        Distance: {{ item[5] }} km<br>
                    {% endif %}

                    <div class="map-frame">
                        <iframe
                            src="https://maps.google.com/maps?q={{ item[3] }},{{ item[4] }}&z=15&output=embed"
                            loading="lazy"
                            allowfullscreen>
                        </iframe>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="no-results">
                No pharmacies found with this medicine.
            </div>
        {% endif %}
    {% endif %}

</div>

<script>
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
        function(position) {
            document.getElementById("user_lat").value = position.coords.latitude;
            document.getElementById("user_lon").value = position.coords.longitude;
        }
    );
}
</script>

</body>
</html>