<!DOCTYPE html>
<html>
<head>
    <title>PharmaFind</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>

<header>
    <div class="header-left">PharmaFind ðŸ’Š</div>
    <div class="header-right">
        <a href="/login">Pharmacy Login</a>
    </div>
</header>

<div class="container">

    <p>Find medicines in nearby pharmacies</p>

    <form method="POST" class="search-box">
        <input type="text" name="medicine" placeholder="Search medicine" required>

        <!-- Hidden GPS fields -->
        <input type="hidden" name="user_lat" id="user_lat">
        <input type="hidden" name="user_lon" id="user_lon">

        <button type="submit">Search</button>
    </form>

    <!-- GPS Debug -->
    <p id="gps_status" style="color: gray; font-size: 14px;"></p>

    <h2>Results:</h2>

    <ul>
        {% for item in results %}
        <div class="result-card">
            <strong>{{ item[0] }}</strong><br>
            Pharmacy: {{ item[1] }}<br>
            Stock: {{ item[2] }}<br>

            {% if item[5] %}
                Distance: {{ item[5] }} km<br>
            {% endif %}

            <div class="map-frame">
                <iframe
                    width="100%"
                    height="180"
                    style="border:0"
                    loading="lazy"
                    allowfullscreen
                    src="https://maps.google.com/maps?q={{ item[3] }},{{ item[4] }}&z=15&output=embed">
                </iframe>
            </div>
        </div>
        {% endfor %}
    </ul>

</div>

<script>
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
        function(position) {
            document.getElementById("user_lat").value = position.coords.latitude;
            document.getElementById("user_lon").value = position.coords.longitude;

            document.getElementById("gps_status").innerText =
                "GPS: " + position.coords.latitude + ", " + position.coords.longitude;
        },
        function(error) {
            document.getElementById("gps_status").innerText =
                "GPS error: " + error.message;
        }
    );
} else {
    document.getElementById("gps_status").innerText =
        "Geolocation not supported by this browser";
}
</script>

</body>
</html>